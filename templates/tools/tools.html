{% extends "base.html" %}{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/tools.css') }}">

<section>
    <div class="explanation-text">
        <p>Here you can find the tools in the catalog. You can search for a tool that you know using the search box below.</p>
        <p>Alternatively, you can filter the tools with respect to the <a href="{{ url_for('workflows') }}#about-section">flow step</a> (i.e., blue box) that they belong to and/or the regulatory question that they are associated with by ticking the boxes below.</p>
        <p>Use the "Apply Filter" button to see results, and click "Clear Filter" to reset the filters.</p>
    </div>

    <!-- Single Filter/Search Form -->
    <form method="get" action="{{ url_for('tools') }}">

        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" name="search" placeholder="Search by tool name..." value="{{ request.args.get('search', '') }}">
            <button type="submit" class="btn-search">Search</button>
        </div>

        <!-- Filters -->
        <div class="filters-container">
            <!-- Stage Filter -->
        <!-- Stage Filter -->
        <div class="filter-section">
            <h3>Filter by Flow Step</h3>
            {% for stage in stages %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="stage" value="{{ stage }}" 
                        {% if stage in selected_stages %}checked{% endif %}>
                    <label class="form-check-label">
                        {{ stage }}
                        <span class="tooltip-icon" data-tooltip="{{ stage_explanations[stage] }}">&#x2753;</span>
                    </label>
                </div>
            {% endfor %}

        </div>

        <!-- Regulatory Questions Filter -->
        <div class="filter-section">
            <h3>Filter by Regulatory Questions</h3>
            {% for question, field in reg_questions.items() %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="reg_q" value="{{ question }}"
                        {% if question in selected_questions %}checked{% endif %}>
                    <label class="form-check-label">
                        {{ question }}
                        <span class="tooltip-icon" data-tooltip="{{ reg_question_explanations[question] }}">&#x2753;</span>
                    </label>
                </div>
            {% endfor %}
        </div>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <button type="submit" class="btn-apply-filter">Apply Filter</button>
            <a href="{{ url_for('tools') }}" class="btn-clear-filter">Clear Filter</a>
        </div>
    </form>

    <!-- Tools List -->
    <div class="row align-items-start">
        <ul>
            {% for item in tools %}
                <div class="card">
                    {% if item.png %}
                        <img src="{{ item.png }}" class="card-img-top" alt="Tool logo">
                    {% endif %}
                    
                    <div class="card-body">
                        <h2 class="card-title">{{ item.service }}</h2>
                        <p id="desc" class="card-text">{{ item.description }}</p>

                        <!-- Tool Webpage -->
                        {% if item.main_url == "no_url" %}
                            <a class="tools-links disabled">No Available Webpage</a> 
                        {% else %}
                            <a href="{{ item.main_url }}" class="btn btn-outline-info" target="_blank">Main Webpage</a>
                        {% endif %}

                        <h3 class="tools-links">&nbsp;&nbsp; - &nbsp;&nbsp;</h3>

                        <!-- Instance Page -->
                        {% if item.inst_url == "no_url" %}
                            <a class="tools-links disabled">No VHP Instance</a> 
                        {% else %}
                            <a href="{{ item.inst_url }}" class="btn btn-outline-info" target="_blank">VHP Instance</a>
                        {% endif %}                   

                        <h3 class="tools-links">&nbsp;&nbsp; - &nbsp;&nbsp;</h3>

                        <!-- Catalog Page -->
                        <a class="tools-links" href="{{ item.url }}" class="btn btn-outline-info">Catalog Page</a>
                        <h3 class="tools-links">&nbsp;&nbsp; - &nbsp;&nbsp;</h3>

                        <!-- Meta-Data -->
                        <a class="tools-links" href="{{ item.meta_data }}" class="btn btn-outline-info">Meta-Data</a>
                    </div>
                </div>
            {% else %}
                <li>No tools found.</li>
            {% endfor %}
        </ul>
    </div>
</section>

{% endblock %}
